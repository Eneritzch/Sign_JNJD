{% extends 'base.html' %}
{% load static %}

{% block title %}Reconocimiento Din√°mico - SignLang AI{% endblock %}

{% block content %}

<!-- Background Elements (igual que static.html) -->
<div class="gradient-bg"></div>
<div class="fixed inset-0 pointer-events-none overflow-hidden" style="z-index: 0;">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
</div>

<div class="container-fluid section-spacing">
    <!-- Header -->
    <header class="text-center mb-12">
        <h2 class="text-5xl md:text-7xl font-black mb-4 text-gray-900">
            Reconocimiento <span class="gradient-text">Din√°mico LSM</span>
        </h2>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            Realiza una se√±a en movimiento y detecta palabras completas con CNN+BiGRU
        </p>
    </header>

    <div class="grid lg:grid-cols-3 gap-6">
        <!-- Panel Principal: Video -->
        <div class="lg:col-span-2">
            <div class="recognition-card">
                <!-- Contenedor de Video -->
                <div class="video-container aspect-video mb-6">
                    <!-- Video en vivo -->
                    <video id="video" class="w-full h-full object-cover" playsinline autoplay></video>
                    
                    <!-- Canvas para detecci√≥n de manos -->
                    <canvas id="handCanvas" class="absolute inset-0 w-full h-full pointer-events-none"></canvas>
                    
                    <!-- Overlay cuando c√°mara apagada -->
                    <div id="cameraOverlay" class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center text-white px-6">
                            <div class="w-24 h-24 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-6 border-2 border-white/30">
                                <i class="fas fa-video text-white text-4xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold mb-3">C√°mara Desactivada</h3>
                            <p class="text-white/80 mb-6">Inicia para comenzar grabaci√≥n de se√±as</p>
                        </div>
                    </div>

                    <!-- Indicador de grabaci√≥n -->
                    <div id="recordingIndicator" class="hidden absolute top-4 left-4">
                        <div class="flex items-center space-x-2 bg-red-500 text-white px-4 py-2 rounded-full shadow-lg" style="animation: pulse 1.5s ease-in-out infinite;">
                            <div class="w-3 h-3 bg-white rounded-full"></div>
                            <span class="font-bold">GRABANDO</span>
                            <span id="recordingTimer">0.0s</span>
                        </div>
                    </div>

                    <!-- Contador de frames -->
                    <div class="absolute top-4 right-4 detection-badge flex items-center space-x-2">
                        <i class="fas fa-film"></i>
                        <span id="frameCount">0 frames</span>
                    </div>

                    <!-- Indicador de mano detectada -->
                    <div id="handDetected" class="hidden absolute bottom-4 right-4 hand-detected-badge">
                        <span class="pulse-dot"></span>
                        <span>MANO DETECTADA</span>
                    </div>

                    <!-- Barra de progreso durante grabaci√≥n -->
                    <div id="recordingProgress" class="hidden absolute bottom-0 left-0 right-0 h-2 bg-white/20">
                        <div id="progressBar" class="h-full bg-gradient-to-r from-green-400 to-blue-500 transition-all" style="width: 0%;"></div>
                    </div>
                </div>

                <!-- Controles -->
                <div id="cameraControls" class="space-y-4">
                    <!-- Bot√≥n Iniciar/Detener C√°mara -->
                    <button id="toggleCameraBtn" class="w-full btn-camera-start text-white font-bold py-4 px-8 rounded-xl flex items-center justify-center space-x-3 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-play text-xl"></i>
                        <span class="text-lg">Iniciar C√°mara</span>
                    </button>

                    <!-- Bot√≥n Grabar Se√±a (oculto hasta que c√°mara est√© activa) -->
                    <button id="recordBtn" class="hidden w-full bg-gradient-to-r from-red-500 to-pink-600 text-white font-bold py-4 px-8 rounded-xl flex items-center justify-center space-x-3 transition-all transform hover:scale-105 shadow-lg">
                        <i class="fas fa-circle text-xl"></i>
                        <span class="text-lg">Grabar Se√±a (<span id="durationDisplay">3.0</span>s)</span>
                    </button>

                    <!-- Control de duraci√≥n -->
                    <div id="durationControl" class="hidden recognition-card">
                        <label class="block text-sm font-bold text-gray-700 mb-2 flex items-center space-x-2">
                            <i class="fas fa-clock text-purple-600"></i>
                            <span>Duraci√≥n de Grabaci√≥n</span>
                        </label>
                        <div class="flex items-center space-x-4">
                            <input type="range" id="durationSlider" min="1.5" max="5" value="3" step="0.5" class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" style="accent-color: #8b5cf6;">
                            <span id="durationValue" class="text-2xl font-black text-purple-600">3.0s</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">
                            <i class="fas fa-info-circle"></i> 
                            El modelo usa <strong>{{ num_frames }} frames</strong> uniformemente distribuidos
                        </p>
                    </div>
                </div>

                <!-- Panel de video grabado -->
                <div id="videoPanel" class="hidden space-y-4 mt-6">
                    <div class="recognition-card">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-gray-800 text-lg flex items-center space-x-2">
                                <div class="icon-box w-10 h-10 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-film text-white"></i>
                                </div>
                                <span>Secuencia Capturada</span>
                            </h3>
                            <button id="restartBtn" class="cta-secondary py-2 px-4 rounded-lg transition-all transform hover:scale-105 flex items-center space-x-2">
                                <i class="fas fa-redo"></i>
                                <span>Nueva Grabaci√≥n</span>
                            </button>
                        </div>

                        <!-- Info del video capturado -->
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="stat-mini text-center">
                                <p class="text-xs text-gray-500 uppercase font-semibold">Frames Capturados</p>
                                <p id="capturedFrames" class="text-2xl font-black text-gray-900">0</p>
                            </div>
                            <div class="stat-mini text-center">
                                <p class="text-xs text-gray-500 uppercase font-semibold">Duraci√≥n</p>
                                <p id="capturedDuration" class="text-2xl font-black text-gray-900">0s</p>
                            </div>
                            <div class="stat-mini text-center">
                                <p class="text-xs text-gray-500 uppercase font-semibold">FPS</p>
                                <p id="capturedFps" class="text-2xl font-black text-gray-900">0</p>
                            </div>
                        </div>

                        <!-- Bot√≥n Reconocer -->
                        <button id="recognizeBtn" class="w-full cta-primary text-white font-bold py-4 px-8 rounded-xl flex items-center justify-center space-x-3 transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-brain text-xl"></i>
                            <span class="text-lg">Reconocer Se√±a con IA</span>
                        </button>

                        <!-- Indicador de carga -->
                        <div id="loadingIndicator" class="hidden mt-4 text-center">
                            <div class="loading-spinner"></div>
                            <p class="text-gray-600 mt-2 font-semibold">Procesando con CNN+BiGRU...</p>
                            <p class="text-xs text-gray-500 mt-1">Analizando {{ num_frames }} frames</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel Lateral: Resultados y Stats -->
        <div class="space-y-6">
            <!-- Resultado del Reconocimiento -->
            <div id="resultPanel" class="hidden prediction-display">
                <div class="text-center relative z-10">
                    <div class="w-20 h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="fas fa-hands text-white text-3xl"></i>
                    </div>
                    <h3 class="font-black text-white text-2xl mb-3">Se√±a Detectada</h3>
                    
                    <!-- Palabra detectada -->
                    <div class="bg-white rounded-2xl p-8 mb-4">
                        <p class="text-sm text-gray-600 mb-2 font-semibold uppercase">Palabra/Frase</p>
                        <p id="detectedWord" class="text-5xl font-black text-purple-700 mb-2" style="word-break: break-word;">HOLA</p>
                        <div class="flex items-center justify-center space-x-2 mt-4">
                            <div class="bg-green-500 rounded-full px-4 py-2">
                                <span id="mainConfidence" class="text-white font-bold">92.5%</span>
                            </div>
                            <span class="text-gray-600 font-semibold">confianza</span>
                        </div>
                    </div>

                    <!-- Top 3 predicciones -->
                    <div class="bg-white/90 backdrop-blur-sm rounded-xl p-4">
                        <p class="text-xs font-bold text-gray-500 uppercase mb-3">Top 3 Predicciones</p>
                        <div id="top3Container" class="space-y-2">
                            <!-- Se llena din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="stat-mini">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-video text-purple-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-xs font-semibold text-gray-500 uppercase">Estado C√°mara</p>
                        <p id="cameraStatus" class="text-xl font-black text-gray-900">Inactiva</p>
                    </div>
                </div>
            </div>

            <div class="stat-mini">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-chart-line text-blue-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-xs font-semibold text-gray-500 uppercase">Reconocimientos</p>
                        <p id="recognitionCount" class="text-xl font-black text-gray-900">0</p>
                    </div>
                </div>
            </div>

            <div class="stat-mini">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-brain text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <p class="text-xs font-semibold text-gray-500 uppercase">Modelo</p>
                        <p class="text-lg font-black text-green-600">CNN+BiGRU</p>
                    </div>
                </div>
            </div>

            <!-- Instrucciones -->
            <div class="instructions-box">
                <div class="flex items-center space-x-3 mb-4">
                    <div class="icon-box">
                        <i class="fas fa-info-circle text-white"></i>
                    </div>
                    <h3 class="font-black text-gray-900 text-lg">C√≥mo Usar</h3>
                </div>
                <ol class="space-y-3">
                    <li class="flex items-start space-x-3">
                        <div class="w-6 h-6 bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 font-bold text-sm">1</div>
                        <span class="text-sm text-gray-700">Inicia la c√°mara y posici√≥nate con buena iluminaci√≥n</span>
                    </li>
                    <li class="flex items-start space-x-3">
                        <div class="w-6 h-6 bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 font-bold text-sm">2</div>
                        <span class="text-sm text-gray-700">Ajusta la duraci√≥n si lo necesitas (1.5s - 5s)</span>
                    </li>
                    <li class="flex items-start space-x-3">
                        <div class="w-6 h-6 bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 font-bold text-sm">3</div>
                        <span class="text-sm text-gray-700">Presiona <strong>"Grabar"</strong> y realiza tu se√±a completa</span>
                    </li>
                    <li class="flex items-start space-x-3">
                        <div class="w-6 h-6 bg-gradient-to-br from-purple-500 to-purple-700 text-white rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 font-bold text-sm">4</div>
                        <span class="text-sm text-gray-700">La grabaci√≥n se detiene autom√°ticamente, luego dale <strong>"Reconocer"</strong></span>
                    </li>
                </ol>
            </div>

            <!-- Palabras disponibles -->
            <div class="recognition-card">
                <h4 class="font-bold text-gray-800 mb-3 flex items-center space-x-2">
                    <i class="fas fa-list-ul text-purple-600"></i>
                    <span>Se√±as Disponibles</span>
                </h4>
                <div class="flex flex-wrap gap-2">
                    {% for label in labels %}
                    <span class="px-3 py-1.5 bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 rounded-full text-sm font-bold border border-purple-200">
                        {{ label }}
                    </span>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js"></script>

<script>
    // ============================================================================
    // ELEMENTOS DOM
    // ============================================================================
    const video = document.getElementById('video');
    const handCanvas = document.getElementById('handCanvas');
    const toggleCameraBtn = document.getElementById('toggleCameraBtn');
    const recordBtn = document.getElementById('recordBtn');
    const recognizeBtn = document.getElementById('recognizeBtn');
    const restartBtn = document.getElementById('restartBtn');
    const cameraOverlay = document.getElementById('cameraOverlay');
    const videoPanel = document.getElementById('videoPanel');
    const resultPanel = document.getElementById('resultPanel');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const recordingProgress = document.getElementById('recordingProgress');
    const progressBar = document.getElementById('progressBar');
    const handDetected = document.getElementById('handDetected');
    const durationControl = document.getElementById('durationControl');
    const durationSlider = document.getElementById('durationSlider');
    const durationValue = document.getElementById('durationValue');
    const durationDisplay = document.getElementById('durationDisplay');

    const handCtx = handCanvas.getContext('2d');

    // ============================================================================
    // ESTADO
    // ============================================================================
    let cameraActive = false;
    let stream = null;
    let hands = null;
    let rafId = null;
    let isRecording = false;
    let recordingStartTime = 0;
    let capturedFrames = [];
    let recordingDuration = 3.0;
    let recognitionsCount = 0;
    let recordingInterval = null;

    const NUM_FRAMES = {{ num_frames }};

    // ============================================================================
    // MEDIAPIPE HANDS
    // ============================================================================
    function initMediaPipe() {
        hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });
        
        hands.setOptions({
            maxNumHands: 2,
            modelComplexity: 0,
            minDetectionConfidence: 0.5,
            minTrackingConfidence: 0.5
        });
        
        hands.onResults(onHandsResults);
    }

    function onHandsResults(results) {
        if (!cameraActive) return;

        const rect = video.getBoundingClientRect();
        handCanvas.width = rect.width;
        handCanvas.height = rect.height;

        handCtx.clearRect(0, 0, handCanvas.width, handCanvas.height);

        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            handDetected.classList.remove('hidden');

            for (const landmarks of results.multiHandLandmarks) {
                // Conexiones
                const connections = [
                    [0,1],[1,2],[2,3],[3,4],
                    [0,5],[5,6],[6,7],[7,8],
                    [5,9],[9,10],[10,11],[11,12],
                    [9,13],[13,14],[14,15],[15,16],
                    [13,17],[17,18],[18,19],[19,20],
                    [0,17]
                ];

                handCtx.strokeStyle = '#00ffcc';
                handCtx.lineWidth = 2;
                handCtx.beginPath();
                
                for (const [start, end] of connections) {
                    const startLm = landmarks[start];
                    const endLm = landmarks[end];
                    handCtx.moveTo(startLm.x * handCanvas.width, startLm.y * handCanvas.height);
                    handCtx.lineTo(endLm.x * handCanvas.width, endLm.y * handCanvas.height);
                }
                handCtx.stroke();

                // Puntos
                for (const lm of landmarks) {
                    handCtx.fillStyle = '#ffff00';
                    handCtx.beginPath();
                    handCtx.arc(lm.x * handCanvas.width, lm.y * handCanvas.height, 4, 0, Math.PI * 2);
                    handCtx.fill();
                }
            }
        } else {
            handDetected.classList.add('hidden');
        }
    }

    async function processFrame() {
        if (cameraActive && hands) {
            try {
                await hands.send({ image: video });
            } catch (e) {
                console.error('Error MediaPipe:', e);
            }
        }
        rafId = requestAnimationFrame(processFrame);
    }

    // ============================================================================
    // C√ÅMARA
    // ============================================================================
    async function startCamera() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({
                video: { 
                    facingMode: 'user',
                    width: { ideal: 640 },
                    height: { ideal: 480 }
                }
            });

            video.srcObject = stream;
            await new Promise(resolve => {
                if (video.readyState >= 2) return resolve();
                video.onloadedmetadata = resolve;
            });

            cameraActive = true;
            initMediaPipe();
            processFrame();

            cameraOverlay.classList.add('hidden');
            toggleCameraBtn.innerHTML = '<i class="fas fa-stop text-xl"></i><span class="text-lg">Detener C√°mara</span>';
            toggleCameraBtn.classList.remove('btn-camera-start');
            toggleCameraBtn.classList.add('btn-camera-stop');
            recordBtn.classList.remove('hidden');
            durationControl.classList.remove('hidden');
            document.getElementById('cameraStatus').textContent = 'Activa';

        } catch (err) {
            console.error('Error c√°mara:', err);
            alert('No se pudo acceder a la c√°mara. Verifica los permisos.');
        }
    }

    function stopCamera() {
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
        }
        cameraActive = false;
        if (rafId) cancelAnimationFrame(rafId);

        cameraOverlay.classList.remove('hidden');
        toggleCameraBtn.innerHTML = '<i class="fas fa-play text-xl"></i><span class="text-lg">Iniciar C√°mara</span>';
        toggleCameraBtn.classList.add('btn-camera-start');
        toggleCameraBtn.classList.remove('btn-camera-stop');
        recordBtn.classList.add('hidden');
        durationControl.classList.add('hidden');
        handDetected.classList.add('hidden');
        document.getElementById('cameraStatus').textContent = 'Inactiva';
    }

    // ============================================================================
    // CAPTURA DE FRAMES
    // ============================================================================
    function captureFrame() {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth || 640;
        canvas.height = video.videoHeight || 480;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);
        return canvas.toDataURL('image/jpeg', 0.85);
    }

    // ============================================================================
    // GRABACI√ìN
    // ============================================================================
    function startRecording() {
        if (!cameraActive) return;

        capturedFrames = [];
        isRecording = true;
        recordingStartTime = Date.now();

        // UI
        recordingIndicator.classList.remove('hidden');
        recordingProgress.classList.remove('hidden');
        recordBtn.disabled = true;
        toggleCameraBtn.disabled = true;
        durationSlider.disabled = true;

        // Capturar frames a ~10 FPS (100ms intervalo)
        const frameInterval = 100;

        recordingInterval = setInterval(() => {
            if (!isRecording) return;

            const frame = captureFrame();
            capturedFrames.push(frame);

            const elapsed = (Date.now() - recordingStartTime) / 1000;
            document.getElementById('recordingTimer').textContent = `${elapsed.toFixed(1)}s`;
            document.getElementById('frameCount').textContent = `${capturedFrames.length} frames`;
            
            const progress = (elapsed / recordingDuration) * 100;
            progressBar.style.width = `${Math.min(progress, 100)}%`;

            if (elapsed >= recordingDuration) {
                stopRecording();
            }
        }, frameInterval);
    }

    function stopRecording() {
        isRecording = false;
        if (recordingInterval) {
            clearInterval(recordingInterval);
            recordingInterval = null;
        }

        recordingIndicator.classList.add('hidden');
        recordingProgress.classList.add('hidden');
        recordBtn.disabled = false;
        toggleCameraBtn.disabled = false;
        durationSlider.disabled = false;
        progressBar.style.width = '0%';

        if (capturedFrames.length > 0) {
            const duration = (Date.now() - recordingStartTime) / 1000;
            const fps = (capturedFrames.length / duration).toFixed(1);

            document.getElementById('capturedFrames').textContent = capturedFrames.length;
            document.getElementById('capturedDuration').textContent = `${duration.toFixed(1)}s`;
            document.getElementById('capturedFps').textContent = fps;

            videoPanel.classList.remove('hidden');
            resultPanel.classList.add('hidden');
            document.getElementById('cameraControls').classList.add('hidden');

            stopCamera();
            
            console.log(`‚úÖ Capturados ${capturedFrames.length} frames en ${duration.toFixed(1)}s (${fps} FPS)`);
        } else {
            alert('‚ö†Ô∏è No se capturaron frames. Intenta de nuevo.');
        }
    }

    // ============================================================================
    // RECONOCIMIENTO
    // ============================================================================
    async function recognizeSequence() {
        if (capturedFrames.length === 0) return;

        loadingIndicator.classList.remove('hidden');
        recognizeBtn.disabled = true;

        try {
            const formData = new FormData();
            formData.append('frames', JSON.stringify(capturedFrames));

            console.log(`üì§ Enviando ${capturedFrames.length} frames al servidor...`);

            const response = await fetch("{% url 'recognition:recognize_dynamic' %}", {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.status === 'success') {
                console.log('Reconocimiento exitoso:', result);

                document.getElementById('detectedWord').textContent = result.class;
                document.getElementById('mainConfidence').textContent = `${result.confidence}%`;

                const top3Container = document.getElementById('top3Container');
                top3Container.innerHTML = result.top3.map((item, idx) => `
                    <div class="prediction-item ${idx === 0 ? 'first-place' : ''}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <span class="text-xs font-bold text-gray-400">#${idx + 1}</span>
                                <span class="font-black text-lg text-gray-800">${item.se√±a}</span>
                            </div>
                            <span class="text-sm font-bold ${idx === 0 ? 'text-green-600' : 'text-gray-500'}">${item.confianza}%</span>
                        </div>
                    </div>
                `).join('');

                resultPanel.classList.remove('hidden');
                recognitionsCount++;
                document.getElementById('recognitionCount').textContent = recognitionsCount;

                if (result.frames_info) {
                    console.log(`Frames recibidos: ${result.frames_info.received}`);
                    console.log(`Frames usados: ${result.frames_info.used}`);
                    console.log(`Sampling: ${result.frames_info.sampling}`);
                }

            } else {
                alert('Error: ' + result.error);
            }

        } catch (error) {
            console.error('Error:', error);
            alert('Error al conectar con el servidor');
        } finally {
            loadingIndicator.classList.add('hidden');
            recognizeBtn.disabled = false;
        }
    }

    // ============================================================================
    // REINICIAR
    // ============================================================================
    function restart() {
        videoPanel.classList.add('hidden');
        resultPanel.classList.add('hidden');
        document.getElementById('cameraControls').classList.remove('hidden');
        capturedFrames = [];
        document.getElementById('frameCount').textContent = '0 frames';
        startCamera();
    }

    // ============================================================================
    // EVENT LISTENERS
    // ============================================================================
    toggleCameraBtn.addEventListener('click', () => {
        if (cameraActive) stopCamera();
        else startCamera();
    });

    recordBtn.addEventListener('click', () => {
        if (!isRecording) startRecording();
    });

    recognizeBtn.addEventListener('click', recognizeSequence);
    restartBtn.addEventListener('click', restart);

    durationSlider.addEventListener('input', (e) => {
        recordingDuration = parseFloat(e.target.value);
        durationValue.textContent = `${recordingDuration.toFixed(1)}s`;
        durationDisplay.textContent = recordingDuration.toFixed(1);
    });
</script>

{% endblock %}