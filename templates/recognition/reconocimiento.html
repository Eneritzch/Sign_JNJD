{% extends 'base.html' %}

{% block title %}Reconocimiento - SignLang AI{% endblock %}

{% block content %}
<div class="relative">
    <!-- Header -->
    <div class="mb-8">
        <h3 class="text-3xl text-center md:text-8xl font-black mb-3 text-gray-900">
            Detección de <span class="gradient-text">Señas LSM</span>
        </h3>
    </div>

    <!-- Stats Mini -->
    <div class="grid grid-cols-3 gap-3 mb-6">
        <div class="stat-mini px-4 py-3 rounded-xl">
            <div class="flex items-center space-x-2">
                <i class="fas fa-camera"></i>
                <div>
                    <p class="text-xs font-bold">Estado</p>
                    <p class="text-sm font-black" id="cameraStatus">Inactiva</p>
                </div>
            </div>
        </div>
        <div class="stat-mini px-4 py-3 rounded-xl">
            <div class="flex items-center space-x-2">
                <i class="fas fa-chart-line"></i>
                <div>
                    <p class="text-xs font-bold">Detecciones</p>
                    <p class="text-sm font-black" id="detectionCount">0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Section (centrado en pantalla completa) -->
    <div class="recognition-card rounded-3xl p-6">
        <!-- Video Container -->
        <div class="video-container aspect-video rounded-2xl overflow-hidden mb-6 border-4 border-gray-800 relative">
            <video id="video" class="w-full h-full object-cover" playsinline></video>
            <canvas id="canvas" style="display: none;"></canvas>
            
            <!-- Camera Overlay -->
            <div id="cameraOverlay" class="absolute inset-0 flex items-center justify-center">
                <div class="text-center text-white">
                    <div class="w-20 h-20 bg-purple-600/20 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm border-2 border-purple-500">
                        <i class="fas fa-video text-purple-400 text-3xl"></i>
                    </div>
                    <p class="text-lg font-bold mb-2">Cámara Desactivada</p>
                    <p class="text-sm text-gray-400">Presiona el botón para iniciar</p>
                </div>
            </div>

            <!-- Recording Indicator -->
            <div id="recordingIndicator" class="hidden absolute top-4 right-4 text-white px-4 py-2 rounded-full text-sm font-bold flex items-center space-x-2">
                <span class="w-3 h-3 bg-white rounded-full animate-pulse"></span>
                <span>GRABANDO</span>
            </div>
        </div>

        <!-- Controls -->
        <div class="flex gap-3">
            <button id="startCameraBtn" class="flex-1 btn-camera-start text-white font-black py-4 px-6 rounded-2xl flex items-center justify-center space-x-3">
                <i class="fas fa-play text-xl"></i>
                <span class="text-lg">Iniciar Cámara</span>
            </button>
            <button id="captureBtn" class="hidden btn-capture px-6 py-4 font-black rounded-2xl">
                <i class="fas fa-camera text-xl"></i>
            </button>
        </div>

        <!-- Instructions -->
        <div class="mt-6 instructions-box rounded-2xl p-4">
            <div class="flex items-start space-x-3">
                <div class="icon-box w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0">
                    <i class="fas fa-info text-white"></i>
                </div>
                <div>
                    <h3 class="font-black text-gray-900 mb-2">Instrucciones de Uso</h3>
                    <ul class="text-sm text-gray-700 space-y-1">
                        <li class="flex items-center"><i class="fas fa-check mr-2 text-xs"></i>Posiciona tu mano frente a la cámara</li>
                        <li class="flex items-center"><i class="fas fa-check mr-2 text-xs"></i>Asegura buena iluminación</li>
                        <li class="flex items-center"><i class="fas fa-check mr-2 text-xs"></i>Mantén el fondo despejado</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const startCameraBtn = document.getElementById('startCameraBtn');
    const captureBtn = document.getElementById('captureBtn');
    const cameraOverlay = document.getElementById('cameraOverlay');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const cameraStatus = document.getElementById('cameraStatus');
    const detectionCount = document.getElementById('detectionCount');

    let stream = null;
    let cameraActive = false;
    let detections = 0;

    async function startCamera() {
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'user',
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                } 
            });
            video.srcObject = stream;
            cameraActive = true;
            
            // Update UI
            cameraOverlay.classList.add('hidden');
            recordingIndicator.classList.remove('hidden');
            cameraStatus.textContent = 'Activa';
            
            startCameraBtn.innerHTML = '<i class="fas fa-stop text-xl"></i><span class="text-lg">Detener Cámara</span>';
            startCameraBtn.className = 'flex-1 btn-camera-stop text-white font-black py-4 px-6 rounded-2xl flex items-center justify-center space-x-3';
            
            captureBtn.classList.remove('hidden');
            video.parentElement.classList.add('camera-active');
            
        } catch (error) {
            alert('Error al acceder a la cámara: ' + error.message);
        }
    }

    function stopCamera() {
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            cameraActive = false;
            
            // Update UI
            cameraOverlay.classList.remove('hidden');
            recordingIndicator.classList.add('hidden');
            cameraStatus.textContent = 'Inactiva';
            
            startCameraBtn.innerHTML = '<i class="fas fa-play text-xl"></i><span class="text-lg">Iniciar Cámara</span>';
            startCameraBtn.className = 'flex-1 btn-camera-start text-white font-black py-4 px-6 rounded-2xl flex items-center justify-center space-x-3';
            
            captureBtn.classList.add('hidden');
            video.parentElement.classList.remove('camera-active');
        }
    }

    startCameraBtn.addEventListener('click', () => {
        if (cameraActive) {
            stopCamera();
        } else {
            startCamera();
        }
    });

    captureBtn.addEventListener('click', () => {
        // Aquí podrías agregar funcionalidad de captura
        captureBtn.innerHTML = '<i class="fas fa-check text-xl"></i>';
        setTimeout(() => {
            captureBtn.innerHTML = '<i class="fas fa-camera text-xl"></i>';
        }, 500);
    });
</script>
{% endblock %}